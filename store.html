<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>状态管理 | Toolkit Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/docs/assets/css/0.styles.61c225ce.css" as="style"><link rel="preload" href="/docs/assets/js/app.bf9abde5.js" as="script"><link rel="preload" href="/docs/assets/js/2.7081bd21.js" as="script"><link rel="preload" href="/docs/assets/js/12.81f60ba6.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.17413e17.js"><link rel="prefetch" href="/docs/assets/js/11.3ba4e15f.js"><link rel="prefetch" href="/docs/assets/js/13.3fc83587.js"><link rel="prefetch" href="/docs/assets/js/3.d04f4a97.js"><link rel="prefetch" href="/docs/assets/js/4.61cab350.js"><link rel="prefetch" href="/docs/assets/js/5.37fc0b0c.js"><link rel="prefetch" href="/docs/assets/js/6.063b7e44.js"><link rel="prefetch" href="/docs/assets/js/7.2d382900.js"><link rel="prefetch" href="/docs/assets/js/8.6c1f93ed.js"><link rel="prefetch" href="/docs/assets/js/9.9b30310a.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.61c225ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Toolkit Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  框架文档
</a></div><div class="nav-item"><a href="/docs/other.html" class="nav-link">
  toolkit 工具库
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  框架文档
</a></div><div class="nav-item"><a href="/docs/other.html" class="nav-link">
  toolkit 工具库
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docs/" aria-current="page" class="sidebar-link">介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/#键路径" class="sidebar-link">键路径</a></li></ul></li><li><a href="/docs/options.html" class="sidebar-link">选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/options.html#dom" class="sidebar-link">DOM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/options.html#el" class="sidebar-link">el</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#template" class="sidebar-link">template</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/options.html#数据" class="sidebar-link">数据</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/options.html#data" class="sidebar-link">data</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#props" class="sidebar-link">props</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#computed" class="sidebar-link">computed</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#methods" class="sidebar-link">methods</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#watch" class="sidebar-link">watch</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#emits" class="sidebar-link">emits</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#store" class="sidebar-link">store</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/options.html#资源" class="sidebar-link">资源</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/options.html#mixins" class="sidebar-link">mixins</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#components" class="sidebar-link">components</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/options.html#生命周期钩子" class="sidebar-link">生命周期钩子</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/options.html#beforemount" class="sidebar-link">beforeMount</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#mounted" class="sidebar-link">mounted</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#beforeupdate" class="sidebar-link">beforeUpdate</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#updated" class="sidebar-link">updated</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#beforeunmount" class="sidebar-link">beforeUnmount</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#unmounted" class="sidebar-link">unmounted</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/options.html#其它选项" class="sidebar-link">其它选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/options.html#inheritattrs" class="sidebar-link">inheritAttrs</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#comments" class="sidebar-link">comments</a></li><li class="sidebar-sub-header"><a href="/docs/options.html#style" class="sidebar-link">style</a></li></ul></li></ul></li><li><a href="/docs/template.html" class="sidebar-link">模板</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/template.html#语法" class="sidebar-link">语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/template.html#绑定数据-文本插值" class="sidebar-link">绑定数据-文本插值</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#绑定数据-动态属性" class="sidebar-link">绑定数据-动态属性</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#class-与-style" class="sidebar-link">class 与 style</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/template.html#指令" class="sidebar-link">指令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/template.html#for" class="sidebar-link">$for</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#if" class="sidebar-link">$if</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#else-if" class="sidebar-link">$else-if</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#else" class="sidebar-link">$else</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#show" class="sidebar-link">$show</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#bind" class="sidebar-link">$bind</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#model" class="sidebar-link">$model</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#ref" class="sidebar-link">$ref</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#allow-html" class="sidebar-link">$allow-html</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#once" class="sidebar-link">$once</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/template.html#特殊属性" class="sidebar-link">特殊属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/template.html#key" class="sidebar-link">key</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/template.html#事件绑定" class="sidebar-link">事件绑定</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/template.html#事件绑定符" class="sidebar-link">事件绑定符 “@”</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#箭头函数" class="sidebar-link">箭头函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/template.html#内置元素" class="sidebar-link">内置元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/template.html#block" class="sidebar-link">block</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#slot" class="sidebar-link">slot</a></li><li class="sidebar-sub-header"><a href="/docs/template.html#transition" class="sidebar-link">transition</a></li></ul></li></ul></li><li><a href="/docs/instance.html" class="sidebar-link">实例方法/属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/instance.html#方法" class="sidebar-link">方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/instance.html#setdata" class="sidebar-link">$setData</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#emit" class="sidebar-link">$emit</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#watch" class="sidebar-link">$watch</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#mount" class="sidebar-link">$mount</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#destroy" class="sidebar-link">$destroy</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/instance.html#属性" class="sidebar-link">属性</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/instance.html#refs" class="sidebar-link">$refs</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#attrs" class="sidebar-link">$attrs</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#el" class="sidebar-link">$el</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#parent" class="sidebar-link">$parent</a></li><li class="sidebar-sub-header"><a href="/docs/instance.html#store" class="sidebar-link">$store</a></li></ul></li></ul></li><li><a href="/docs/component.html" class="sidebar-link">组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/component.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/docs/component.html#注册局部组件" class="sidebar-link">注册局部组件</a></li><li class="sidebar-sub-header"><a href="/docs/component.html#注册全局组件" class="sidebar-link">注册全局组件</a></li><li class="sidebar-sub-header"><a href="/docs/component.html#组件库" class="sidebar-link">组件库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/component.html#导出组件" class="sidebar-link">导出组件</a></li><li class="sidebar-sub-header"><a href="/docs/component.html#导入组件" class="sidebar-link">导入组件</a></li></ul></li></ul></li><li><a href="/docs/store.html" aria-current="page" class="active sidebar-link">状态管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/store.html#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/docs/store.html#state" class="sidebar-link">state</a></li><li class="sidebar-sub-header"><a href="/docs/store.html#getters" class="sidebar-link">getters</a></li><li class="sidebar-sub-header"><a href="/docs/store.html#actions" class="sidebar-link">actions</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="状态管理"><a href="#状态管理" class="header-anchor">#</a> 状态管理</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>Store 是一个状态管理工具。当应用程序由一个复杂的组件树构成时，很可能出现多个组件共享某些状态的情况：</p> <ol><li>多个组件依赖于同一状态。</li> <li>来自不同组件的行为需要变更同一状态。</li></ol> <p>对于问题一，使用 <code>props</code> 传参的方法对于多层嵌套的组件将会非常繁琐，并且对于兄弟组件间的状态传递无能为力。<br>
对于问题二，我们经常会采用父子组件直接引用或者通过事件来变更和同步状态的多份拷贝。这些模式非常脆弱，通常会导致无法维护的代码。</p> <p>而使用 Store 可以解决这些问题。通过把组件的共享状态抽取出来，以一个全局单例模式来管理。在这种模式下，不管组件在组件树的哪个位置，都能获取或变更状态。</p> <p>Store 的实例相当于一个容器，它包含着你的应用中大部分的状态 (state)。Store 和单纯的全局对象有以下两点不同：</p> <ol><li>当 store 中的状态发生变化时，依赖这些状态的组件也会随之更新。</li> <li>你不能直接改变 store 中的状态。改变 store 中的状态的唯一途径就是显式地提交 (commit)。</li></ol> <ul><li><p><strong>用法</strong>：</p> <p>首先，创建一个 Store 的实例 store。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">toolkit<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>现在，可以通过 <code>store.state</code> 来获取状态对象，以及通过 <code>store.commit</code> 方法触发状态变更：</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'count'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// -&gt; 1</span>

store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span><span class="token string">'My Title'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token comment">// -&gt; My Title</span>
</code></pre></div><p>为了让组件使用 store，需要通过 <code>store</code> 选项绑定 store 对象。绑定后，其子孙组件要使用 store 时，可以通过组件函数的参数 <code>ctx</code> 的 <code>ctx.store</code> 属性获取 store 对象。</p> <p>绑定 store 对象时，只有调用 <code>store.provide</code> 方法，指定 store 对象要向组件提供的状态，组件实例的 <code>this.$store</code> 属性才能读取到相应的状态。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>toolkit<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  template<span class="token operator">:</span>
    <span class="token string">'&lt;div&gt;{{ $store.count }}&lt;/div&gt;\
    &lt;comp&gt;&lt;/comp&gt;'</span><span class="token punctuation">,</span>
  store<span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    comp<span class="token operator">:</span> component
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  el<span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    template<span class="token operator">:</span> <span class="token string">'&lt;div&gt;{{ $store.title }} {{ $store.count }}&lt;/div&gt;'</span><span class="token punctuation">,</span>
    store<span class="token operator">:</span> ctx<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>现在可以在组件实例中访问 <code>this.$store</code> 属性，而且在根实例中只能读取到一个状态 <code>count</code>，在子组件 <code>&lt;comp&gt;</code> 实例中能读取到两个状态 <code>title</code> 和 <code>count</code>。</p> <p>为了简化语法，<code>$store</code> 与 store 对象不同，它去掉了 <code>state</code> 对象这一层，从而可以直接读取状态。</p> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count  <span class="token comment">// -&gt; 1</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>count  <span class="token comment">// -&gt; 1</span>
</code></pre></div><p><code>$store</code> 还具有 <code>commit</code> 和 <code>onupdate</code> 两个方法。</p> <p><code>commit</code> 方法用于提交变更。注意，可以提交任何在 store 中定义的状态，<strong>不受</strong> <code>store.provide</code> 方法限制。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code>methods<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span><span class="token string">'My Title'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

    <span class="token comment">// store.provide 没有向组件提供 content 状态，也可以使用 commit 修改状态。</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span><span class="token string">'My Content'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>onupdate</code> 方法用于监听变更。注意，<strong>只会</strong>监听到 <code>store.provide</code> 方法提供的状态的变更。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token function-variable function">mounted</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">onupdate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">changeState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span> <span class="token keyword">in</span> changeState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>changeState<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="state"><a href="#state" class="header-anchor">#</a> state</h2> <ul><li><p><strong>类型</strong>：<code>Object</code></p></li> <li><p><strong>详细</strong>：</p> <p>一个包含了全部的应用层级状态的对象。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">toolkit<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>使用 Store 并不意味着你需要将所有的状态放入 Store。虽然将所有的状态放到 Store 会使状态变化更显式和易调试，但也会使代码变得冗长和不直观。如果有些状态严格属于单个组件，最好还是作为组件的局部状态。你应该根据你的应用开发需要进行权衡和确定。</p></li></ul> <h2 id="getters"><a href="#getters" class="header-anchor">#</a> getters</h2> <ul><li><p><strong>类型</strong>：<code>Object</code></p></li> <li><p><strong>详细</strong>：</p> <p>有时候我们需要从 <code>store</code> 中的 <code>state</code> 中派生出一些状态，例如对列表进行过滤并计数：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code>computed<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">activeItemsCount</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">.</span>length
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果有多个组件需要用到此属性，我们要么复制这个函数，或者抽取到一个共享函数然后在多处导入它——无论哪种方式都不是很理想。</p> <p>在 Store 中我们可以定义 getter（可以认为是 store 的计算属性）。就像计算属性一样，getter 的返回值会根据它的依赖被缓存起来，且只有当它的依赖值发生了改变才会被重新计算。</p> <p><code>getters</code> 选项是一个由若干 getter 组成的对象，键为 getter 的名称，值为 getter 的计算函数。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">toolkit<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  state<span class="token operator">:</span> <span class="token punctuation">{</span>
    items<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span> active<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> title<span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span> active<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  getters<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">activeItems</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>访问 getter 与访问 <code>state</code> 中的状态是一样的：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>activeItems<span class="token punctuation">)</span> <span class="token comment">// -&gt; [{ id: 1, title: '...', active: true }]</span>
</code></pre></div><p>但 getter 不能被 <code>commit</code>，因为它是根据依赖而更新的：</p> <div class="language-js extra-class"><pre class="language-js"><code>store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'activeItems'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// -&gt; commit 会报错</span>
</code></pre></div><p>getter 也可以依赖其它 getter：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code>getters<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">activeItemsCount</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeItems<span class="token punctuation">.</span>length
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">activeItems</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>activeItemsCount<span class="token punctuation">)</span> <span class="token comment">// -&gt; 1</span>
</code></pre></div><p>我们可以很容易地在任何组件中使用它：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  store<span class="token operator">:</span> store<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&quot;activeItemsCount&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>activeItemsCount<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="actions"><a href="#actions" class="header-anchor">#</a> actions</h2> <ul><li><p><strong>类型</strong>：<code>Object</code></p></li> <li><p><strong>详细</strong>：</p> <p>有时候我们的某些功能对状态的变更逻辑可能会比较复杂：</p> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">nextStep</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">toStep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> steps <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>steps<span class="token punctuation">,</span>
            currentStep <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>currentStep<span class="token punctuation">,</span>
            curIdx <span class="token operator">=</span> steps<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>currentStep<span class="token punctuation">)</span><span class="token punctuation">,</span>
            next

        <span class="token keyword">if</span> <span class="token punctuation">(</span>toStep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> toIdx <span class="token operator">=</span> steps<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>toStep<span class="token punctuation">)</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>toIdx <span class="token operator">&gt;</span> curIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                next <span class="token operator">=</span> toStep
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>steps <span class="token operator">+</span> <span class="token string">&quot;中不存在&quot;</span> <span class="token operator">+</span> toStep<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            next <span class="token operator">=</span> steps<span class="token punctuation">[</span>curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token string">&quot;stepStack&quot;</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>stepStack<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>currentStep<span class="token punctuation">)</span>
              <span class="token string">&quot;step&quot;</span><span class="token operator">:</span> next
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果有多个组件需要用到此功能，我们要么复制这个函数，或者抽取到一个共享函数然后在多处导入它——无论哪种方式都不是很理想。</p> <p>在 Store 中我们可以定义 action。它用于封装一些对状态进行变更的功能，从而在组件中轻易复用这些功能。</p> <p><code>actions</code> 选项是一个由若干 action 组成的对象，键为 action 的名称，值为 action 的 handler 函数。这个函数就是我们变更状态的地方，它会接受 <code>state</code> 对象作为第一个参数，<code>commit</code> 方法作为第二个参数，它的 <code>this</code> 为 store 实例对象。</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token punctuation">{</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span>
        steps<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stepA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stepB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stepC&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stepD&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        currentStep<span class="token operator">:</span> <span class="token string">&quot;stepB&quot;</span><span class="token punctuation">,</span>
        stepStack<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    actions<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">nextStep</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> commit<span class="token punctuation">,</span> toStep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> steps <span class="token operator">=</span> state<span class="token punctuation">.</span>steps<span class="token punctuation">,</span>
                currentStep <span class="token operator">=</span> state<span class="token punctuation">.</span>currentStep<span class="token punctuation">,</span>
                curIdx <span class="token operator">=</span> steps<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>currentStep<span class="token punctuation">)</span><span class="token punctuation">,</span>
                next

            <span class="token keyword">if</span> <span class="token punctuation">(</span>toStep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> toIdx <span class="token operator">=</span> steps<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>toStep<span class="token punctuation">)</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>toIdx <span class="token operator">&gt;</span> curIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    next <span class="token operator">=</span> toStep
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>steps <span class="token operator">+</span> <span class="token string">&quot;中不存在&quot;</span> <span class="token operator">+</span> toStep<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                next <span class="token operator">=</span> steps<span class="token punctuation">[</span>curIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  <span class="token string">&quot;stepStack&quot;</span><span class="token operator">:</span> state<span class="token punctuation">.</span>stepStack<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>currentStep<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token string">&quot;step&quot;</span><span class="token operator">:</span> next
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>你不能直接调用一个 action 的 handler 函数。你需要通过调用 <code>store.dispatch</code> 方法来调用它，第一个参数为要调用的 action 的名称。你还可以传入第二个参数，该参数会作为 action 的 handler 函数的第三个参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 直接用 store 实例对象调用</span>
store<span class="token punctuation">.</span><span class="token function">dipatch</span><span class="token punctuation">(</span><span class="token string">'nextStep'</span><span class="token punctuation">,</span> <span class="token string">'stepD'</span><span class="token punctuation">)</span>

<span class="token comment">//在组件实例中调用</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dipatch</span><span class="token punctuation">(</span><span class="token string">'nextStep'</span><span class="token punctuation">,</span> <span class="token string">'stepD'</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/component.html" class="prev">
        组件
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.bf9abde5.js" defer></script><script src="/docs/assets/js/2.7081bd21.js" defer></script><script src="/docs/assets/js/12.81f60ba6.js" defer></script>
  </body>
</html>
